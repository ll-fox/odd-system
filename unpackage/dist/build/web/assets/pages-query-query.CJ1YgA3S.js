import{o as e,b as t,w as a,a as l,f as s,t as u,d as i,h as n,k as r,l as c,i as d,s as o,e as f,r as m,n as b,I as g}from"./index-DWDmCve2.js";import{_}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=_({components:{FeedbackDialog:_({props:{visible:{type:Boolean,default:!1},title:{type:String,default:"反馈"}},data:()=>({inputValue:""}),methods:{onCancel(){this.$emit("close")},onConfirm(){this.$emit("confirm",this.inputValue),this.inputValue=""}}},[["render",function(o,f,m,b,g,_){const k=n,p=r,h=c,y=d;return m.visible?(e(),t(y,{key:0,class:"dialog"},{default:a((()=>[l(y,{class:"dialog-content"},{default:a((()=>[l(k,{class:"dialog-title"},{default:a((()=>[s(u(m.title),1)])),_:1}),l(p,{class:"dialog-input",modelValue:g.inputValue,"onUpdate:modelValue":f[0]||(f[0]=e=>g.inputValue=e),placeholder:"请输入您的反馈内容"},null,8,["modelValue"]),l(y,{class:"dialog-buttons"},{default:a((()=>[l(h,{onClick:_.onCancel},{default:a((()=>[s("取消")])),_:1},8,["onClick"]),l(h,{onClick:_.onConfirm},{default:a((()=>[s("提交")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):i("",!0)}],["__scopeId","data-v-f4b3d70b"]])},data:()=>({trackingNumber:"",result:null,loading:!1,feedbackText:"",showFeedbackDialog:!1}),methods:{async onQuery(){if(!this.loading){if(this.loading=!0,this.result=null,!this.trackingNumber)return o({title:"请填写快递单号",icon:"none"}),void(this.loading=!1);try{const e=await f.callFunction({name:"query-tracking",data:{trackingNumber:this.trackingNumber}});200===e.result.code?this.result=e.result.data:404===e.result.code?o({title:e.result.message||"未找到相关记录",icon:"none"}):o({title:e.result.message||"查询失败",icon:"none"})}catch(e){o({title:"网络错误，请重试",icon:"none"})}finally{this.loading=!1}}},getStatusClass(e){switch(e){case"待处理":return"status-pending";case"处理中":return"status-processing";case"已处理":return"status-completed";default:return""}},formatTime(e){if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}:${String(t.getSeconds()).padStart(2,"0")}`},openFeedbackDialog(){this.showFeedbackDialog=!0},async submitSecondaryFeedback(e){if(e.trim())try{200===(await f.callFunction({name:"update-feedback",data:{trackingNumber:this.result.trackingNumber,secondaryFeedback:e,feedbackTime:Date.now()}})).result.code&&(o({title:"反馈提交成功"}),this.showFeedbackDialog=!1,this.onQuery())}catch(t){o({title:"提交失败，请重试",icon:"none"})}else o({title:"反馈内容不能为空",icon:"none"})}}},[["render",function(r,o,f,_,k,p){const h=n,y=g,C=d,F=c,v=m("FeedbackDialog");return e(),t(C,{class:"content"},{default:a((()=>[l(C,{class:"form-container"},{default:a((()=>[l(C,{class:"form-item"},{default:a((()=>[l(h,{class:"label"},{default:a((()=>[s("快递单号")])),_:1}),l(y,{class:"input",modelValue:k.trackingNumber,"onUpdate:modelValue":o[0]||(o[0]=e=>k.trackingNumber=e),placeholder:"请输入快递单号"},null,8,["modelValue"])])),_:1}),l(F,{class:"submit-btn",onClick:p.onQuery},{default:a((()=>[l(h,null,{default:a((()=>[s("查询")])),_:1})])),_:1},8,["onClick"])])),_:1}),k.result?(e(),t(C,{key:0,class:"result-container"},{default:a((()=>[l(C,{class:"result-card"},{default:a((()=>[l(C,{class:"result-section"},{default:a((()=>[l(h,{class:"section-title"},{default:a((()=>[s("快递信息")])),_:1}),l(C,{class:"result-item"},{default:a((()=>[l(h,{class:"result-label"},{default:a((()=>[s("快递单号")])),_:1}),l(h,{class:"result-value"},{default:a((()=>[s(u(k.result.trackingNumber),1)])),_:1})])),_:1}),l(C,{class:"result-item"},{default:a((()=>[l(h,{class:"result-label"},{default:a((()=>[s("快递公司")])),_:1}),l(h,{class:"result-value"},{default:a((()=>[s(u(k.result.courier),1)])),_:1})])),_:1}),l(C,{class:"result-item"},{default:a((()=>[l(h,{class:"result-label"},{default:a((()=>[s("备注")])),_:1}),l(h,{class:"result-value"},{default:a((()=>[s(u(k.result.remark),1)])),_:1})])),_:1})])),_:1}),l(C,{class:"result-section"},{default:a((()=>[l(h,{class:"section-title"},{default:a((()=>[s("处理状态")])),_:1}),l(C,{class:"result-item"},{default:a((()=>[l(h,{class:"result-label"},{default:a((()=>[s("状态")])),_:1}),l(h,{class:b(["result-value",p.getStatusClass(k.result.status)])},{default:a((()=>[s(u(k.result.status),1)])),_:1},8,["class"])])),_:1}),"已处理"===k.result.status&&k.result.feedback?(e(),t(C,{key:0,class:"result-item"},{default:a((()=>[l(h,{class:"result-label"},{default:a((()=>[s("处理意见")])),_:1}),l(C,{class:"feedback-content"},{default:a((()=>[l(h,{class:"result-value"},{default:a((()=>[s(u(k.result.feedback),1)])),_:1}),l(C,{class:"feedback-link",onClick:p.openFeedbackDialog},{default:a((()=>[s("不满意？继续反馈")])),_:1},8,["onClick"])])),_:1})])),_:1})):i("",!0),k.result.secondaryFeedback?(e(),t(C,{key:1,class:"result-item"},{default:a((()=>[l(h,{class:"result-label"},{default:a((()=>[s("上次反馈内容")])),_:1}),l(h,{class:"result-value"},{default:a((()=>[s(u(k.result.secondaryFeedback),1)])),_:1})])),_:1})):i("",!0),k.result.feedbackTime?(e(),t(C,{key:2,class:"result-item"},{default:a((()=>[l(h,{class:"result-label"},{default:a((()=>[s("上次反馈时间")])),_:1}),l(h,{class:"result-value"},{default:a((()=>[s(u(p.formatTime(k.result.feedbackTime)),1)])),_:1})])),_:1})):i("",!0),l(C,{class:"result-item"},{default:a((()=>[l(h,{class:"result-label"},{default:a((()=>[s("创建时间")])),_:1}),l(h,{class:"result-value"},{default:a((()=>[s(u(p.formatTime(k.result.createdAt)),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):i("",!0),k.loading?(e(),t(C,{key:1,class:"global-loading"},{default:a((()=>[l(C,{class:"loading"})])),_:1})):i("",!0),l(v,{visible:k.showFeedbackDialog,title:"二次反馈",onClose:o[1]||(o[1]=e=>k.showFeedbackDialog=!1),onConfirm:p.submitSecondaryFeedback},null,8,["visible","onConfirm"])])),_:1})}],["__scopeId","data-v-131ecdda"]]);export{k as default};
