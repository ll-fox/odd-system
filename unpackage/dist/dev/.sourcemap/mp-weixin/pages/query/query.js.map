{"version":3,"file":"query.js","sources":["pages/query/query.vue","pages/query/query.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"content\">\n    <view class=\"form-container\">\n      <view class=\"form-item\">\n        <text class=\"label\">快递单号</text>\n        <input class=\"input\" v-model=\"trackingNumber\" placeholder=\"请输入快递单号\" />\n      </view>\n      <button class=\"submit-btn\" @click=\"onQuery\">\n        <text>查询</text>\n      </button>\n    </view>\n\n    <!-- 查询结果模块 -->\n    <view class=\"result-container\" v-if=\"result\">\n      <view class=\"result-card\">\n        <view class=\"result-section\">\n          <view class=\"section-header\">\n            <text class=\"section-title\">快递信息</text>\n            <view \n              v-if=\"['待处理', '处理中'].includes(result.status)\" \n              class=\"edit-link\" \n              @click=\"openEditDialog\"\n            >\n              编辑\n            </view>\n          </view>\n          <view class=\"result-item\">\n            <text class=\"result-label\">快递单号</text>\n            <text class=\"result-value\">{{ result.trackingNumber }}</text>\n          </view>\n          <view class=\"result-item\">\n            <text class=\"result-label\">快递公司</text>\n            <text class=\"result-value\">{{ result.courier }}</text>\n          </view>\n          <view class=\"result-item\">\n            <text class=\"result-label\">备注</text>\n            <text class=\"result-value\">{{ result.remark }}</text>\n          </view>\n        </view>\n\n        <view class=\"result-section\">\n          <text class=\"section-title\">处理状态</text>\n          <view class=\"result-item\">\n            <text class=\"result-label\">状态</text>\n            <text class=\"result-value\" :class=\"getStatusClass(result.status)\">{{ result.status }}</text>\n          </view>\n          <view class=\"result-item\" v-if=\"result.status === '已处理' && result.feedback\">\n            <text class=\"result-label\">处理意见</text>\n            <view class=\"feedback-content\">\n              <text class=\"result-value\">{{ result.feedback }}</text>\n              <view class=\"feedback-link\" @click=\"openFeedbackDialog\">不满意？继续反馈</view>\n            </view>\n          </view>\n          <view class=\"result-item\" v-if=\"result.secondaryFeedback\">\n            <text class=\"result-label\">上次反馈内容</text>\n            <text class=\"result-value\">{{ result.secondaryFeedback }}</text>\n          </view>\n          <view class=\"result-item\" v-if=\"result.feedbackTime\">\n            <text class=\"result-label\">上次反馈时间</text>\n            <text class=\"result-value\">{{ formatTime(result.feedbackTime) }}</text>\n          </view>\n          <view class=\"result-item\">\n            <text class=\"result-label\">创建时间</text>\n            <text class=\"result-value\">{{ formatTime(result.createdAt) }}</text>\n          </view>\n        </view>\n      </view>\n    </view>\n\n    <view v-if=\"loading\" class=\"global-loading\">\n      <view class=\"loading\"></view>\n    </view>\n\n    <FeedbackDialog\n      :visible=\"showFeedbackDialog\"\n      title=\"二次反馈\"\n      @close=\"showFeedbackDialog = false\"\n      @confirm=\"submitSecondaryFeedback\"\n    />\n\n    <EditCourierDialog\n      :visible=\"showEditDialog\"\n      title=\"编辑快递信息\"\n      :trackingData=\"result\"\n      @close=\"showEditDialog = false\"\n      @confirm=\"updateCourierInfo\"\n    />\n  </view>\n</template>\n\n<script>\nimport FeedbackDialog from '@/components/FeedbackDialog.vue';\nimport EditCourierDialog from '@/components/EditCourierDialog.vue';\n\nexport default {\n  components: {\n    FeedbackDialog,\n    EditCourierDialog\n  },\n  data() {\n    return {\n      trackingNumber: '',\n      result: null,\n      loading: false,\n      feedbackText: '',\n      showFeedbackDialog: false,\n      showEditDialog: false\n    };\n  },\n  methods: {\n    async onQuery() {\n      if (this.loading) return;\n      this.loading = true;\n      this.result = null; // 清空之前的结果\n\n      if (!this.trackingNumber) {\n        uni.showToast({\n          title: '请填写快递单号',\n          icon: 'none',\n        });\n        this.loading = false;\n        return;\n      }\n\n      try {\n        const res = await uniCloud.callFunction({\n          name: 'query-tracking',\n          data: {\n            trackingNumber: this.trackingNumber,\n          },\n        });\n\n        if (res.result.code === 200) {\n          this.result = res.result.data;\n        } else if (res.result.code === 404) {\n          uni.showToast({\n            title: res.result.message || '未找到相关记录',\n            icon: 'none',\n          });\n        } else {\n          uni.showToast({\n            title: res.result.message || '查询失败',\n            icon: 'none',\n          });\n        }\n      } catch (error) {\n        uni.showToast({\n          title: '网络错误，请重试',\n          icon: 'none',\n        });\n      } finally {\n        this.loading = false;\n      }\n    },\n    // 根据状态返回对应的样式类\n    getStatusClass(status) {\n      switch (status) {\n        case '待处理':\n          return 'status-pending';\n        case '处理中':\n          return 'status-processing';\n        case '已处理':\n          return 'status-completed';\n        default:\n          return '';\n      }\n    },\n    // 格式化时间\n    formatTime(time) {\n      if (!time) return '';\n      const date = new Date(time);\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      const hours = String(date.getHours()).padStart(2, '0');\n      const minutes = String(date.getMinutes()).padStart(2, '0');\n      const seconds = String(date.getSeconds()).padStart(2, '0');\n      return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n    },\n    openFeedbackDialog() {\n      this.showFeedbackDialog = true;\n    },\n    async submitSecondaryFeedback(content) {\n      if (!content.trim()) {\n        uni.showToast({ title: '反馈内容不能为空', icon: 'none' });\n        return;\n      }\n      \n      try {\n        const res = await uniCloud.callFunction({\n          name: 'update-feedback',\n          data: {\n            trackingNumber: this.result.trackingNumber,\n            secondaryFeedback: content,\n            feedbackTime: Date.now()\n          }\n        });\n\n        if (res.result.code === 200) {\n          uni.showToast({ title: '反馈提交成功' });\n          this.showFeedbackDialog = false;\n          this.onQuery();\n        }\n      } catch (error) {\n        uni.showToast({ title: '提交失败，请重试', icon: 'none' });\n      }\n    },\n    openEditDialog() {\n      this.showEditDialog = true;\n    },\n    async updateCourierInfo(courierData) {\n      if (!courierData.courier.trim()) {\n        uni.showToast({ title: '快递公司不能为空', icon: 'none' });\n        return;\n      }\n      \n      try {\n        this.loading = true;\n        const res = await uniCloud.callFunction({\n          name: 'update-courier-info',\n          data: {\n            trackingNumber: courierData.trackingNumber,\n            courier: courierData.courier,\n            remark: courierData.remark\n          }\n        });\n\n        if (res.result.code === 200) {\n          uni.showToast({ title: '更新成功' });\n          this.showEditDialog = false;\n          this.onQuery();\n        } else {\n          uni.showToast({ title: res.result.message || '更新失败', icon: 'none' });\n        }\n      } catch (error) {\n        uni.showToast({ title: '提交失败，请重试', icon: 'none' });\n      } finally {\n        this.loading = false;\n      }\n    }\n  },\n};\n</script>\n\n<style>\n.content {\n  padding: 20px;\n  background: linear-gradient(180deg, #f5f5f7 0%, #ffffff 100%);\n}\n\n.form-container {\n  background: rgba(255, 255, 255, 0.8);\n  backdrop-filter: blur(20px);\n  padding: 20px;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n}\n\n.form-item {\n  margin-bottom: 20px;\n}\n\n.label {\n  display: block;\n  font-size: 14px;\n  color: #1c1c1e;\n  margin-bottom: 8px;\n  font-weight: 500;\n}\n\n.input {\n  width: 100%;\n  height: 40px;\n  line-height: 40px;\n  padding: 0 12px;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n  border-radius: 8px;\n  box-sizing: border-box;\n  background: rgba(255, 255, 255, 0.8);\n  font-size: 14px;\n  color: #1c1c1e;\n}\n\n.submit-btn {\n  width: 100%;\n  height: 44px;\n  line-height: 44px;\n  background-color: #c49b45;\n  color: #fff;\n  border-radius: 10px;\n  margin-top: 20px;\n  font-size: 16px;\n  font-weight: 500;\n  border: none;\n  transition: all 0.2s ease;\n}\n\n.submit-btn:active {\n  background-color: #c49b45;\n  opacity: 0.9;\n}\n\n/* 查询结果模块样式 */\n.result-container {\n  margin-top: 20px;\n}\n\n.result-card {\n  background: #fff;\n  border-radius: 12px;\n  overflow: hidden;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.result-section {\n  padding: 16px;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.1);\n}\n\n.result-section:last-child {\n  border-bottom: none;\n}\n\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}\n\n.section-title {\n  font-size: 13px;\n  color: #8E8E93;\n  font-weight: 500;\n}\n\n.edit-link {\n  color: #c49b45;\n  font-size: 13px;\n  padding: 2px 4px;\n  text-decoration: none;\n}\n\n.result-item {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px 0;\n}\n\n.result-label {\n  font-size: 15px;\n  color: #1C1C1E;\n  font-weight: 400;\n}\n\n.result-value {\n  font-size: 15px;\n  color: #1C1C1E;\n  text-align: right;\n  max-width: 60%;\n}\n\n/* 状态样式 */\n.status-pending {\n  color: #FF9500;\n}\n\n.status-processing {\n  color: #007AFF;\n}\n\n.status-completed {\n  color: #34C759;\n}\n\n.global-loading {\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 999;\n}\n\n.loading {\n  width: 40px;\n  height: 40px;\n  border: 4px solid rgba(196, 155, 69, 0.2);\n  border-top: 4px solid #c49b45;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n.feedback-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n}\n\n.feedback-link {\n  color: #c49b45;\n  font-size: 12px;\n  text-decoration: underline;\n  margin-top: 4px;\n  padding: 2px 0;\n}\n</style> ","import MiniProgramPage from '/Users/liulin/liulin/project/odd-system/odd-system/pages/query/query.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uniCloud"],"mappings":"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"}